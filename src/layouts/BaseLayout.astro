---
import '../styles/global.css';

interface NavItem {
  label: string;
  href: string;
}

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'MORI CROWN! ã®å…¬å¼ã‚µã‚¤ãƒˆ' } = Astro.props;

const mainNav: NavItem[] = [
  { label: 'ãƒ›ãƒ¼ãƒ ', href: '/' },
  { label: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹', href: '/news/' },
  { label: 'ã‚¿ãƒ¬ãƒ³ãƒˆ', href: '/talents/' },
  { label: 'é…ä¿¡', href: '/schedule/' },
  { label: 'ã‚·ãƒ§ãƒƒãƒ—', href: '/shop/' },
  { label: 'ã‚ªãƒ¼ãƒ‡ã‚£ã‚·ãƒ§ãƒ³', href: '/audition/' }
];

const utilityNav: NavItem[] = [
  { label: 'ãƒ•ã‚¡ãƒ³æ´»å‹•ã‚¬ã‚¤ãƒ‰', href: '/fan-works/' },
  { label: 'ä¼šç¤¾æ¦‚è¦', href: '/company/' },
  { label: 'ãŠå•ã„åˆã‚ã›', href: '/contact/' }
];

const toHref = (path: string) => {
  if (/^https?:\/\//.test(path)) {
    return path;
  }
  const cleaned = path.replace(/^\/+/, '');
  return cleaned ? `${import.meta.env.BASE_URL}${cleaned}` : import.meta.env.BASE_URL;
};

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const normalizedPath = base && Astro.url.pathname.startsWith(base)
  ? Astro.url.pathname.slice(base.length) || '/'
  : Astro.url.pathname;

const isActive = (href: string) => {
  if (href === '/') {
    return normalizedPath === '/';
  }
  return normalizedPath.startsWith(href);
};

const siteOrigin = Astro.site?.toString() ?? 'https://ayutaz.github.io/';
const canonical = new URL(Astro.url.pathname, siteOrigin).toString();
---

<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;700;800&family=Zen+Maru+Gothic:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <a class="skip-link" href="#main-content">æœ¬æ–‡ã¸ã‚¹ã‚­ãƒƒãƒ—</a>

    <header class="site-header">
      <div class="container nav-shell">
        <a class="brand" href={toHref('/')}>
          <span class="brand-mark">ğŸƒ</span>
          <span class="brand-text">MORI CROWN!</span>
        </a>

        <nav class="global-nav" aria-label="ä¸»è¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
          {
            mainNav.map((item) => (
              <a class={`nav-link ${isActive(item.href) ? 'is-active' : ''}`} href={toHref(item.href)}>
                {item.label}
              </a>
            ))
          }
        </nav>
      </div>
    </header>

    <main id="main-content" class="page-main">
      <slot />
    </main>

    <footer class="site-footer">
      <div class="container footer-grid">
        <div>
          <p class="footer-brand">MORI CROWN!</p>
          <p class="footer-copy">ã‚„ã•ã—ã„ç·‘ã®ä¸–ç•Œã‹ã‚‰ã€æ¯æ—¥ã«é…ä¿¡ã®é­”æ³•ã‚’ã€‚</p>
        </div>

        <nav aria-label="è£œåŠ©ãƒ¡ãƒ‹ãƒ¥ãƒ¼" class="footer-nav">
          {
            utilityNav.map((item) => (
              <a href={toHref(item.href)}>{item.label}</a>
            ))
          }
        </nav>
      </div>
    </footer>
  </body>
</html>
